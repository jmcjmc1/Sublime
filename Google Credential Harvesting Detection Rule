name: "Phishing: Google Credential Harvesting Link"
description: >
  Detects phishing emails impersonating Google services (Gmail, Drive,
  Docs, or Google Account security) that attempt to harvest credentials
  via suspicious or lookalike login URLs.
severity: high
confidence: 0.82

authors:
  - "Your Name"

references:
  - "https://attack.mitre.org/techniques/T1566/"

tags:
  - phishing
  - credential-harvesting
  - brand-impersonation
  - google
  - workspace

rule:
  and:
    # Email contains at least one link
    - any:
        - length(body.links) > 0

    # Google branding in link text or URL
    - any:
        - regex:
            value: lower(body.links[].display_text)
            pattern: "(google|gmail|drive|docs|workspace|account)"

        - regex:
            value: lower(body.links[].href)
            pattern: "(accounts|signin|login|security|verify)"

    # Exclude legitimate Google domains
    - not:
        any:
          - regex:
              value: lower(body.links[].href)
              pattern: "^https://accounts\\.google\\.com"
          - regex:
              value: lower(body.links[].href)
              pattern: "^https://.*\\.google\\.com"
          - regex:
              value: lower(body.links[].href)
              pattern: "^https://.*\\.googleusercontent\\.com"

    # Common Google phishing lures
    - any:
        - regex:
            value: lower(body.text)
            pattern: >
              (unusual sign-in|security alert|verify your account|
               storage full|shared a document|review activity)

response:
  remediation:
    - "Block email"
    - "Alert S
