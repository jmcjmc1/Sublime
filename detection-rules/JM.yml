name: "QR code containing URL detected in attachment"
description: |
  Detects one or more QR codes within an inbound (only) email attachment (image, PDF, or Office Document) contains a QR code. 
  In order to detect QR Phishing which attempts to move the user's session to a mobile device and so bypass standard URL filters.
type: "rule"
severity: "medium"
source: |
  type.inbound
  // look at incoming mail only, ignore internal (auth) or outbound //
  and any(attachments,
  // examines all files attached to the email of file types: //
    (
      .file_type == "pdf" or
      .file_type == "jpg" or
      .file_type == "png" or
      .file_type in $file_types_images or 
      // or do it better for images using predefined list of image types //
      .file_extension in $file_extensions_macros
      // and check for office docs with a QR code embedded
    )
    and any(file.explode(.), .scan.qr.type == "url")
    // file analysis enrichment function that extracts the file into constituent parts and metadata and then in this case filters for where QR scanner identified a URL //
    and any(file.explode(.), .scan.qr.type == "url")
    and any([beta.linkanalysis(.scan.qr.url)],.credphish.disposition == "phishing")
    // pass the URL to LinkAnalysis //
  )
authors:
  - name: "Juliet McMullen, Sublime Community"
tags:
  - "Quishing"
  - "QR Code"
  - "Social engineering"
attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "QR code"
  - "Image as content"
detection_methods:
  - "QR code analysis"
  - "File analysis"
false_positives:
  - "Legitimate emails containing QR codes with URLS from legitimate tools such as identity authenticators e.g OKTA etc or others from legitimate sources"


















